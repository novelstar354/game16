<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>STOP SLOT ULTIMATE</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<style>
*{box-sizing:border-box}
body{
 margin:0;
 background:#111;
 color:#fff;
 font-family:system-ui,sans-serif;
 display:flex;
 justify-content:center;
 align-items:center;
 height:100vh;
}
#game{
 background:#222;
 padding:12px;
 border-radius:16px;
 width:min(380px,96vw);
 transition:transform .1s;
}
h1{text-align:center;margin:6px 0}
#reels{display:flex;gap:8px;margin:12px 0}
.reel{
 flex:1;height:90px;background:#000;border-radius:12px;
 font-size:48px;display:flex;justify-content:center;align-items:center;
 box-shadow:inset 0 0 12px #666;
}
.controls{display:flex;gap:6px;margin-bottom:6px}
button,select{
 flex:1;padding:10px;font-size:16px;border:none;border-radius:10px
}
button{background:#ffcc00}
.stop{background:#ff6666}
#info{text-align:center;font-size:14px}
.win{color:#00ff88;font-weight:bold}

/* æ¼”å‡º */
.flash{animation:flash .2s 4}
@keyframes flash{
 0%{background:#222}
 50%{background:#fff;color:#000}
}
.shake{animation:shake .3s}
@keyframes shake{
 0%{transform:translate(0)}
 25%{transform:translate(5px)}
 50%{transform:translate(-5px)}
 75%{transform:translate(5px)}
}
.rare{
 animation:rare 1s infinite alternate;
}
@keyframes rare{
 from{filter:drop-shadow(0 0 5px gold)}
 to{filter:drop-shadow(0 0 20px gold)}
}

/* å±¥æ­´ */
#historyBox{
 margin-top:10px;
 background:#111;
 border-radius:12px;
 padding:6px;
 max-height:160px;
 overflow-y:auto;
 font-size:13px;
}
.historyItem{
 border-bottom:1px solid #333;
 padding:4px 0;
}
.historyItem:last-child{border:none}
.historyBig{color:#00ff88}
.historyJackpot{color:#ffd700;font-weight:bold}
</style>
</head>
<body>

<div id="game">
<h1>ğŸ° STOP SLOT</h1>

<div id="reels">
 <div class="reel" id="r1">â“</div>
 <div class="reel" id="r2">â“</div>
 <div class="reel" id="r3">â“</div>
</div>

<div class="controls">
 <button onclick="start()">START</button>
 <button class="stop" onclick="stopReel(0)">STOP</button>
 <button class="stop" onclick="stopReel(1)">STOP</button>
 <button class="stop" onclick="stopReel(2)">STOP</button>
</div>

<div class="controls">
 <select id="bet">
  <option value="10">BET 10</option>
  <option value="20">BET 20</option>
  <option value="50">BET 50</option>
 </select>
 <button onclick="toggleSound()">ğŸ”Š</button>
</div>

<div class="controls">
 <button onclick="save()">ğŸ’¾</button>
 <button onclick="clearHistory()">ğŸ§¹å±¥æ­´å‰Šé™¤</button>
</div>

<div id="info">
 ãƒ¡ãƒ€ãƒ«: <span id="medal"></span><br>
 <span id="msg"></span>
</div>

<!-- å±¥æ­´ -->
<div id="historyBox"></div>

</div>

<script>
/* ===== DOM ===== */
const game=document.getElementById("game");
const r1=document.getElementById("r1");
const r2=document.getElementById("r2");
const r3=document.getElementById("r3");
const reels=[r1,r2,r3];
const betEl=document.getElementById("bet");
const medalEl=document.getElementById("medal");
const msgEl=document.getElementById("msg");
const historyBox=document.getElementById("historyBox");

/* ===== ã‚µã‚¦ãƒ³ãƒ‰ ===== */
const ctx=new AudioContext();
function tone(f,t=120){
 const o=ctx.createOscillator(),g=ctx.createGain();
 o.frequency.value=f;
 o.connect(g);g.connect(ctx.destination);
 o.start();
 g.gain.exponentialRampToValueAtTime(.001,ctx.currentTime+t/1000);
 setTimeout(()=>o.stop(),t);
}

/* ===== ç¢ºç‡ ===== */
const table=[
 {s:"ğŸ’",w:30},{s:"ğŸ‹",w:30},{s:"ğŸ””",w:20},
 {s:"â­",w:15},{s:"7ï¸âƒ£",w:4},{s:"ğŸ’",w:1}
];

let medal=100;
let bgmOn=true;
let spinning=[false,false,false];
let timers=[];
let history=[];

load();update();renderHistory();

/* ===== ãƒ¡ã‚¤ãƒ³ ===== */
function start(){
 const bet=+betEl.value;
 if(medal<bet){msg("ãƒ¡ãƒ€ãƒ«ä¸è¶³");return;}
 medal-=bet;
 msg("");
 reels.forEach((r,i)=>{
  if(spinning[i])return;
  spinning[i]=true;
  timers[i]=setInterval(()=>r.textContent=lot(),60);
 });
 update();
}

function stopReel(i){
 if(!spinning[i])return;
 clearInterval(timers[i]);
 spinning[i]=false;
 tone(800,80);
 if(spinning.every(v=>!v))judge();
}

function judge(){
 const a=r1.textContent,b=r2.textContent,c=r3.textContent;
 const bet=+betEl.value;
 let gain=0,type="ãƒã‚ºãƒ¬",cls="";

 reels.forEach(r=>r.classList.remove("rare"));

 if(a===b&&b===c){
  let m=5;
  if(a==="7ï¸âƒ£"){m=20;type="BIG";cls="historyBig";}
  if(a==="ğŸ’"){m=50;type="JACKPOT";cls="historyJackpot";}
  gain=bet*m;
  medal+=gain;
  flash();shake();
  reels.forEach(r=>r.classList.add("rare"));
 }else if(a===b||b===c||a===c){
  gain=bet*2;
  medal+=gain;
  type="å°å½“ãŸã‚Š";
  cls="historyBig";
  flash();
 }

 addHistory(`${a}${b}${c}`,type,gain,cls);
 msg(type+(gain?` +${gain}`:""));
 update();
}

/* ===== å±¥æ­´ ===== */
function addHistory(result,type,gain,cls){
 history.unshift({result,type,gain,cls});
 history=history.slice(0,30);
 save();
 renderHistory();
}

function renderHistory(){
 historyBox.innerHTML=history.map(h=>
  `<div class="historyItem ${h.cls}">
   ${h.result} ï½œ ${h.type} ${h.gain?`(+${h.gain})`:""}
  </div>`
 ).join("");
}

function clearHistory(){
 history=[];
 save();
 renderHistory();
 msg("å±¥æ­´å‰Šé™¤");
}

/* ===== æ¼”å‡º ===== */
function flash(){
 game.classList.add("flash");
 setTimeout(()=>game.classList.remove("flash"),500);
}
function shake(){
 game.classList.add("shake");
 setTimeout(()=>game.classList.remove("shake"),300);
}

/* ===== æŠ½é¸ ===== */
function lot(){
 let r=Math.random()*100,sum=0;
 for(let t of table){sum+=t.w;if(r<sum)return t.s;}
}

/* ===== UI ===== */
function update(){medalEl.textContent=medal;}
function msg(t){msgEl.textContent=t;}
function toggleSound(){bgmOn=!bgmOn;msg(bgmOn?"ğŸ”ŠON":"ğŸ”‡OFF");}

/* ===== ã‚»ãƒ¼ãƒ– ===== */
function save(){
 localStorage.setItem("slot",JSON.stringify({medal,history}));
}
function load(){
 const d=localStorage.getItem("slot");
 if(d){
  const o=JSON.parse(d);
  medal=o.medal??100;
  history=o.history??[];
 }
}
</script>
</body>
</html>
