<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>SLOT MACHINE </title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
 <link rel="icon" href="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTXpgl9VrjKZLmPonXHSLJ8uLyNOPi7chR_Mtt0SCVJTx5-OI3J9WMJv_aO&s=10" sizes="16Ã—16" type="image/png" />  
<style>
*{box-sizing:border-box}
body{
 margin:0;background:#111;color:#fff;
 font-family:system-ui,sans-serif;
 display:flex;justify-content:center;align-items:center;min-height:100vh;
}
#game{
 background:#222;padding:12px;border-radius:16px;
 width:min(460px,96vw);
}
.fullscreen #game{
 width:100vw;height:100vh;border-radius:0;
 display:flex;flex-direction:column;justify-content:center;
}
h1,h3{text-align:center;margin:6px 0}
#reels{display:flex;gap:8px;margin:10px 0}
.reel{
 flex:1;height:90px;background:#000;border-radius:12px;
 font-size:44px;display:flex;justify-content:center;align-items:center;
 box-shadow:inset 0 0 12px #666;
 transition:.15s;
}
.fullscreen .reel{height:120px;font-size:56px}

.flash{filter:brightness(2)}
.rare{animation:rainbow 1s}
@keyframes rainbow{
 0%{filter:hue-rotate(0deg)}
 100%{filter:hue-rotate(360deg)}
}
.shake{animation:shake .3s}
@keyframes shake{
 0%{transform:translate(0)}
 25%{transform:translate(3px)}
 50%{transform:translate(-3px)}
 75%{transform:translate(3px)}
}

.controls{display:flex;gap:6px;margin-bottom:6px;flex-wrap:wrap}
button,select{
 flex:1;padding:10px;font-size:16px;border:none;border-radius:10px
}
button{background:#ffcc00}
.stop{background:#ff6666}
.auto{background:#66ccff}
#info{text-align:center;font-size:14px}
.win{color:#00ff88;font-weight:bold}
.jackpot{color:#ff66ff;font-weight:bold}

#history,#stats{
 background:#111;border-radius:10px;padding:6px;
 font-size:12px;margin-bottom:6px;max-height:120px;overflow:auto
}
.plus{color:#00ff88}
.minus{color:#ff6666}
</style>
</head>
<body>

<div id="game">
<h1>SLOT MACHINE</h1>

<div id="reels">
 <div class="reel" id="r1">â“</div>
 <div class="reel" id="r2">â“</div>
 <div class="reel" id="r3">â“</div>
</div>

<div class="controls">
 <button onclick="start()">START</button>
 <button class="stop" onclick="stopReel(0)">STOP</button>
 <button class="stop" onclick="stopReel(1)">STOP</button>
 <button class="stop" onclick="stopReel(2)">STOP</button>
</div>

<div class="controls">
 <select id="bet">
  <option value="10">BET 10</option>
  <option value="20">BET 20</option>
  <option value="50">BET 50</option>
 </select>
 <button onclick="toggleSound()">ğŸ”Š BGMãƒ»SE</button>
 <button onclick="toggleFull()">ğŸ–¥ ãƒ•ãƒ«ã‚¹ã‚¯ãƒªãƒ¼ãƒ³</button>
 <button class="auto" onclick="toggleAuto()">â–¶AUTO</button>
</div>

<div class="controls">
 <button onclick="save()">ğŸ’¾ ã‚»ãƒ¼ãƒ–</button>
 <button onclick="clearAll()">ğŸ—‘ ãƒªã‚»ãƒƒãƒˆ</button>
</div>

<div id="info">
 ãƒ¡ãƒ€ãƒ«: <span id="medal"></span><br>
 <span id="msg"></span><br>
 <small>
  Space/Enter:START | 1-3:STOP | B:BET | S:SOUND | F:FULL | A:AUTO
 </small>
</div>

<h3>ğŸ“Š çµ±è¨ˆ</h3>
<div id="stats"></div>

<h3>ğŸ“œ å±¥æ­´</h3>
<div id="history"></div>
</div>

<script>
/* ===== è¨­å®š ===== */
const table=[
 {s:"ğŸ’",w:25},{s:"ğŸ‹",w:25},{s:"ğŸ””",w:18},
 {s:"â­",w:15},{s:"ğŸï¸",w:10},{s:"7ï¸âƒ£",w:5},{s:"ğŸ’",w:2}
];

let medal=100,sound=true;
let spinning=[false,false,false],timers=[];
let history=[];
let stats={play:0,win:0,diff:0};

let auto=false,autoTimer=null;

const reels=[r1,r2,r3];

/* ===== ã‚µã‚¦ãƒ³ãƒ‰ ===== */
function se(f=600,t=80){
 if(!sound)return;
 const a=new AudioContext(),o=a.createOscillator();
 o.frequency.value=f;o.connect(a.destination);o.start();
 setTimeout(()=>{o.stop();a.close()},t);
}

/* ===== ã‚²ãƒ¼ãƒ  ===== */
function start(){
 const bet=+betEl.value;
 if(medal<bet){msg("ãƒ¡ãƒ€ãƒ«ä¸è¶³");auto=false;return;}
 medal-=bet;
 reels.forEach((r,i)=>{
  if(spinning[i])return;
  spinning[i]=true;
  timers[i]=setInterval(()=>r.textContent=lot(),60);
 });
 update();
}

function stopReel(i){
 if(!spinning[i])return;
 clearInterval(timers[i]);
 spinning[i]=false;
 reels[i].classList.add("shake");
 se(800);
 setTimeout(()=>reels[i].classList.remove("shake"),150);
 if(spinning.every(v=>!v))judge();
}

function judge(){
 stats.play++;
 const a=r1.textContent,b=r2.textContent,c=r3.textContent;
 const bet=+betEl.value;
 let gain=0,text="ãƒã‚ºãƒ¬",cls="";

 if(a===b&&b===c){
  let m=a==="ğŸ’"?100:a==="7ï¸âƒ£"?30:a==="ğŸï¸"?15:5;
  gain=bet*m; medal+=gain;
  text="ğŸ‰ BIG WIN x"+m;
  cls=a==="ğŸ’"?"jackpot":"win";
  stats.win++;
  reels.forEach(r=>r.classList.add("flash","rare"));
  setTimeout(()=>reels.forEach(r=>r.classList.remove("flash","rare")),600);
 }else if(a===b||b===c||a===c){
  gain=bet*2; medal+=gain;
  text="âœ¨ WIN x2"; cls="win"; stats.win++;
 }

 const diff=gain-bet;
 stats.diff+=diff;

 history.unshift({
  t:new Date().toLocaleTimeString(),
  line:`${a}${b}${c} â†’ ${text}`,
  diff
 });
 history=history.slice(0,30);

 renderHistory();renderStats();
 msg(text,cls);update();
}

/* ===== ã‚ªãƒ¼ãƒˆãƒ—ãƒ¬ã‚¤ ===== */
function toggleAuto(){
 auto=!auto;
 msg(auto?"â–¶ AUTO ON":"â–  AUTO OFF");
 if(auto){
  autoTimer=setInterval(()=>{
   if(spinning.some(v=>v))return;
   start();
   setTimeout(()=>stopReel(0),600);
   setTimeout(()=>stopReel(1),900);
   setTimeout(()=>stopReel(2),1200);
  },1600);
 }else{
  clearInterval(autoTimer);
 }
}

/* ===== ãƒ•ãƒ«ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ ===== */
function toggleFull(){
 if(!document.fullscreenElement){
  document.documentElement.requestFullscreen();
  document.body.classList.add("fullscreen");
 }else{
  document.exitFullscreen();
  document.body.classList.remove("fullscreen");
 }
}

/* ===== ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ ===== */
function lot(){
 let r=Math.random()*100,sum=0;
 for(let t of table){sum+=t.w;if(r<sum)return t.s}
}
function renderHistory(){
 historyEl.innerHTML=history.map(h=>{
  const s=h.diff>=0?"+":"";
  const c=h.diff>=0?"plus":"minus";
  return `<div>[${h.t}] ${h.line} <span class="${c}">(${s}${h.diff}æš)</span></div>`;
 }).join("");
}
function renderStats(){
 statsEl.innerHTML=
  `ç·å›è»¢: ${stats.play}<br>
   å‹åˆ©: ${stats.win}<br>
   å‹ç‡: ${stats.play?Math.round(stats.win/stats.play*100):0}%<br>
   ç·å·®æš: ${stats.diff}`;
}
function update(){medalEl.textContent=medal}
function msg(t,c=""){msgEl.textContent=t;msgEl.className=c}

/* ===== ä¿å­˜ ===== */
function save(){
 localStorage.setItem("slot",JSON.stringify({medal,history,stats}));
 msg("ã‚»ãƒ¼ãƒ–å®Œäº†");
}
function load(){
 const d=localStorage.getItem("slot");
 if(d){
  const o=JSON.parse(d);
  medal=o.medal;history=o.history||[];stats=o.stats||stats;
 }
 renderHistory();renderStats();update();
}
function clearAll(){
 localStorage.removeItem("slot");
 medal=100;history=[];stats={play:0,win:0,diff:0};
 renderHistory();renderStats();update();
 msg("å®Œå…¨ãƒªã‚»ãƒƒãƒˆ");
}
function toggleSound(){sound=!sound;msg(sound?"ğŸ”ŠON":"ğŸ”‡OFF")}

/* ===== ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ ===== */
document.addEventListener("keydown",e=>{
 if(e.code==="Space"||e.code==="Enter"){e.preventDefault();start()}
 if(e.key==="1")stopReel(0);
 if(e.key==="2")stopReel(1);
 if(e.key==="3")stopReel(2);
 if(e.key==="b"||e.key==="B")
  betEl.selectedIndex=(betEl.selectedIndex+1)%betEl.length;
 if(e.key==="s"||e.key==="S")toggleSound();
 if(e.key==="f"||e.key==="F")toggleFull();
 if(e.key==="a"||e.key==="A")toggleAuto();
});

/* ===== DOM ===== */
const betEl=document.getElementById("bet");
const medalEl=document.getElementById("medal");
const msgEl=document.getElementById("msg");
const historyEl=document.getElementById("history");
const statsEl=document.getElementById("stats");

load();
</script>
</body>
</html>
