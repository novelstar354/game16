<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>SLOT MACHINE</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<link rel="icon" href="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTXpgl9VrjKZLmPonXHSLJ8uLyNOPi7chR_Mtt0SCVJTx5-OI3J9WMJv_aO&s=10" sizes="16√ó16" type="image/png" />  
<style>
*{box-sizing:border-box}
body{
  margin:0;
  background:#111;
  color:#fff;
  font-family:system-ui,sans-serif;
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
}
#game{
  background:#222;
  padding:12px;
  border-radius:16px;
  width:min(420px,96vw);
}
h1{text-align:center;margin:6px 0}

#reels{display:flex;gap:8px;margin:10px 0}
.reel{
  flex:1;height:90px;
  background:#000;
  border-radius:12px;
  font-size:44px;
  display:flex;
  justify-content:center;
  align-items:center;
  box-shadow:inset 0 0 12px #666;
  transition:transform .15s, filter .15s;
}

.flash{filter:brightness(2)}
.shake{animation:shake .3s}
@keyframes shake{
  0%{transform:translate(0)}
  25%{transform:translate(3px)}
  50%{transform:translate(-3px)}
  75%{transform:translate(3px)}
  100%{transform:translate(0)}
}

.controls{display:flex;gap:6px;margin-bottom:6px}
button,select{
  flex:1;
  padding:10px;
  font-size:16px;
  border:none;
  border-radius:10px;
}
button{background:#ffcc00}
.stop{background:#ff6666}

#info{text-align:center;font-size:14px}
.win{color:#00ff88;font-weight:bold}
.jackpot{color:#ff66ff;font-weight:bold}

#history{
  background:#111;
  border-radius:10px;
  padding:6px;
  max-height:90px;
  overflow:auto;
  font-size:12px;
}
</style>
</head>
<body>

<div id="game">
<h1>SLOT MACHINE</h1>

<div id="reels">
  <div class="reel" id="r1">‚ùì</div>
  <div class="reel" id="r2">‚ùì</div>
  <div class="reel" id="r3">‚ùì</div>
</div>

<div class="controls">
  <button onclick="start()">START</button>
  <button class="stop" onclick="stopReel(0)">STOP</button>
  <button class="stop" onclick="stopReel(1)">STOP</button>
  <button class="stop" onclick="stopReel(2)">STOP</button>
</div>

<div class="controls">
  <select id="bet">
    <option value="10">BET 10</option>
    <option value="20">BET 20</option>
    <option value="50">BET 50</option>
  </select>
  <button onclick="toggleSound()">BGM„ÉªSE</button>
</div>

<div class="controls">
  <button onclick="save()">„Çª„Éº„Éñ</button>
  <button onclick="clearAll()">üóë Â±•Ê≠¥ÂâäÈô§</button>
</div>

<div id="info">
  „É°„ÉÄ„É´: <span id="medal"></span><br>
  <span id="msg"></span><br>
  <small>
    ‚å® Space/Enter:START | 1-3:STOP | B:BET | S:SOUND
  </small>
</div>

<h3>üìú Â±•Ê≠¥</h3>
<div id="history"></div>
</div>

<script>
/* ===== Á¢∫Áéá„ÉÜ„Éº„Éñ„É´ÔºàBARËøΩÂä†Ôºâ ===== */
const table=[
 {s:"üçí",w:25},
 {s:"üçã",w:25},
 {s:"üîî",w:18},
 {s:"‚≠ê",w:15},
 {s:"üéûÔ∏è",w:10},
 {s:"7Ô∏è‚É£",w:5},
 {s:"üíé",w:2}
];

let medal=100;
let sound=true;
let spinning=[false,false,false];
let timers=[];
let history=[];

const reels=[r1,r2,r3];

/* ===== „Çµ„Ç¶„É≥„Éâ ===== */
const bgm=new AudioContext();
function playBGM(){
 if(!sound)return;
 const o=bgm.createOscillator();
 o.frequency.value=120;
 o.connect(bgm.destination);
 o.start();
 setTimeout(()=>o.stop(),500);
}

function se(freq=600,time=100){
 if(!sound)return;
 const a=new AudioContext(),o=a.createOscillator();
 o.frequency.value=freq;
 o.connect(a.destination);
 o.start();
 setTimeout(()=>{o.stop();a.close();},time);
}

/* ===== „Ç≤„Éº„É† ===== */
function start(){
 const bet=+betEl.value;
 if(medal<bet){msg("„É°„ÉÄ„É´‰∏çË∂≥");return;}
 medal-=bet;
 reels.forEach((r,i)=>{
   if(spinning[i])return;
   spinning[i]=true;
   timers[i]=setInterval(()=>r.textContent=lot(),60);
 });
 playBGM();
 update();
}

function stopReel(i){
 if(!spinning[i])return;
 clearInterval(timers[i]);
 spinning[i]=false;
 reels[i].classList.add("shake");
 se(800,80);
 setTimeout(()=>reels[i].classList.remove("shake"),150);
 if(spinning.every(v=>!v))judge();
}

function judge(){
 const a=r1.textContent,b=r2.textContent,c=r3.textContent;
 let bet=+betEl.value;
 let result="„Éè„Ç∫„É¨";
 let cls="";
 if(a===b&&b===c){
   let m= a==="üíé"?100 :
          a==="7Ô∏è‚É£"?30 :
          a==="üéûÔ∏è"?15 : 5;
   medal+=bet*m;
   result="üéâ BIG WIN x"+m;
   cls= a==="üíé"?"jackpot":"win";
   flash();
 }else if(a===b||b===c||a===c){
   medal+=bet*2;
   result="‚ú® WIN x2";
   cls="win";
 }
 history.unshift(`${a}${b}${c} ‚Üí ${result}`);
 history=history.slice(0,20);
 renderHistory();
 msg(result,cls);
 update();
}

function lot(){
 let r=Math.random()*100,sum=0;
 for(let t of table){
   sum+=t.w;
   if(r<sum)return t.s;
 }
}

/* ===== ÊºîÂá∫ ===== */
function flash(){
 reels.forEach(r=>r.classList.add("flash"));
 setTimeout(()=>reels.forEach(r=>r.classList.remove("flash")),300);
}

/* ===== UI ===== */
function update(){medalEl.textContent=medal;}
function msg(t,c=""){msgEl.textContent=t;msgEl.className=c;}

function renderHistory(){
 historyEl.innerHTML=history.map(h=>`<div>${h}</div>`).join("");
}

/* ===== ‰øùÂ≠ò ===== */
function save(){
 localStorage.setItem("slot",JSON.stringify({medal,history}));
 msg("„Çª„Éº„ÉñÂÆå‰∫Ü");
}
function load(){
 const d=localStorage.getItem("slot");
 if(d){
   const o=JSON.parse(d);
   medal=o.medal;
   history=o.history||[];
 }
 renderHistory();
}

/* ‚òÖ Â±•Ê≠¥ÂâäÈô§Ôºã„É°„ÉÄ„É´„É™„Çª„ÉÉ„Éà ‚òÖ */
function clearAll(){
 localStorage.removeItem("slot");
 history=[];
 medal=100;
 renderHistory();
 update();
 msg("Â±•Ê≠¥„Å®„É°„ÉÄ„É´„Çí„É™„Çª„ÉÉ„Éà");
}

function toggleSound(){
 sound=!sound;
 msg(sound?"üîäON":"üîáOFF");
}

/* ===== „Ç≠„Éº„Éú„Éº„Éâ ===== */
document.addEventListener("keydown",e=>{
 if(e.code==="Space"||e.code==="Enter"){e.preventDefault();start();}
 if(e.key==="1")stopReel(0);
 if(e.key==="2")stopReel(1);
 if(e.key==="3")stopReel(2);
 if(e.key==="b"||e.key==="B")
   betEl.selectedIndex=(betEl.selectedIndex+1)%betEl.length;
 if(e.key==="s"||e.key==="S")toggleSound();
});

/* ===== DOM ===== */
const betEl=document.getElementById("bet");
const medalEl=document.getElementById("medal");
const msgEl=document.getElementById("msg");
const historyEl=document.getElementById("history");

load();update();
</script>
</body>
</html>
