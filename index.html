<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>SLOT MACHINE</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
 <link rel="icon" href="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTXpgl9VrjKZLmPonXHSLJ8uLyNOPi7chR_Mtt0SCVJTx5-OI3J9WMJv_aO&s=10" sizes="16√ó16" type="image/png" />  
<style>
*{
 box-sizing:border-box;
 -webkit-tap-highlight-color:transparent;
 touch-action:manipulation;
}
body{
 margin:0;
 background:#111;
 color:#fff;
 font-family:system-ui,sans-serif;
 display:flex;
 justify-content:center;
 align-items:center;
 min-height:100vh;
}
#game{
 background:#222;
 padding:12px;
 border-radius:18px;
 width:clamp(320px,96vw,420px);
 box-shadow:0 0 20px #000;
 transition:transform .15s;
}
h1{text-align:center;margin:6px 0}
#reels{display:flex;gap:8px;margin:10px 0}
.reel{
 flex:1;
 height:clamp(70px,20vw,100px);
 background:#000;
 border-radius:14px;
 font-size:clamp(36px,10vw,52px);
 display:flex;
 justify-content:center;
 align-items:center;
 box-shadow:inset 0 0 12px #666;
}
.controls{display:flex;gap:6px;margin-bottom:6px}
button,select{
 flex:1;min-height:48px;
 font-size:16px;border:none;border-radius:12px
}
button{background:#ffcc00;font-weight:bold}
.stop{background:#ff6666}
#info{text-align:center;font-size:14px}
.win{color:#00ff88;font-weight:bold}

/* ÊºîÂá∫ */
.flash{animation:flash .2s 4}
@keyframes flash{
 0%{background:#222}
 50%{background:#fff;color:#000}
}
.shake{animation:shake .25s}
@keyframes shake{
 0%{transform:translate(0)}
 25%{transform:translate(4px)}
 50%{transform:translate(-4px)}
 75%{transform:translate(4px)}
}
.rare{
 animation:rare 1s infinite alternate;
}
@keyframes rare{
 from{filter:drop-shadow(0 0 6px gold)}
 to{filter:drop-shadow(0 0 20px gold)}
}

/* Â±•Ê≠¥ */
#historyBox{
 margin-top:8px;
 background:#111;
 border-radius:14px;
 padding:6px;
 max-height:140px;
 overflow-y:auto;
 font-size:13px;
}
.historyItem{
 padding:4px 0;
 border-bottom:1px solid #333;
}
.historyBig{color:#00ff88}
.historyJackpot{color:#ffd700;font-weight:bold}
</style>
</head>
<body>

<div id="game">
<h1>SLOT MACHINE</h1>

<div id="reels">
 <div class="reel" id="r1">‚ùì</div>
 <div class="reel" id="r2">‚ùì</div>
 <div class="reel" id="r3">‚ùì</div>
</div>

<div class="controls">
 <button onclick="start()">START</button>
 <button class="stop" onclick="stopReel(0)">STOP</button>
 <button class="stop" onclick="stopReel(1)">STOP</button>
 <button class="stop" onclick="stopReel(2)">STOP</button>
</div>

<div class="controls">
 <select id="bet">
  <option value="10">BET 10</option>
  <option value="20">BET 20</option>
  <option value="50">BET 50</option>
 </select>
 <button onclick="toggleSound()">BGM„ÉªSE</button>
</div>

<div class="controls">
 <button onclick="save()">„Çª„Éº„Éñ</button>
 <button onclick="clearHistory()">Â±•Ê≠¥ÂâäÈô§</button>
</div>

<div id="info">
 „É°„ÉÄ„É´: <span id="medal"></span><br>
 <span id="msg"></span>
</div>

<div id="historyBox"></div>
</div>

<script>
/* DOM */
const reels=[
 document.getElementById("r1"),
 document.getElementById("r2"),
 document.getElementById("r3")
];
const betEl=document.getElementById("bet");
const medalEl=document.getElementById("medal");
const msgEl=document.getElementById("msg");
const historyBox=document.getElementById("historyBox");
const game=document.getElementById("game");

/* Á¢∫Áéá„ÉÜ„Éº„Éñ„É´ */
const table=[
 {s:"üçí",w:28},
 {s:"üçã",w:28},
 {s:"üîî",w:18},
 {s:"‚≠ê",w:13},
 {s:"üéûÔ∏è",w:8},   // BAR
 {s:"7Ô∏è‚É£",w:4},
 {s:"üíé",w:1}
];

let medal=100;
let spinning=[false,false,false];
let timers=[];
let history=[];
let sound=true;

load();update();renderHistory();

/* „Ç≤„Éº„É† */
function start(){
 const bet=+betEl.value;
 if(medal<bet){msg("„É°„ÉÄ„É´‰∏çË∂≥");return;}
 medal-=bet; msg("");
 reels.forEach((r,i)=>{
  if(spinning[i])return;
  spinning[i]=true;
  timers[i]=setInterval(()=>r.textContent=lot(),60);
 });
 update();
}
function stopReel(i){
 if(!spinning[i])return;
 clearInterval(timers[i]);
 spinning[i]=false;
 if(spinning.every(v=>!v))judge();
}
function judge(){
 const [a,b,c]=reels.map(r=>r.textContent);
 const bet=+betEl.value;
 let gain=0,type="„Éè„Ç∫„É¨",cls="";
 reels.forEach(r=>r.classList.remove("rare"));

 if(a===b&&b===c){
  let m=5;
  if(a==="üéûÔ∏è"){m=10;type="BAR BIG";}
  if(a==="7Ô∏è‚É£"){m=20;type="BIG";}
  if(a==="üíé"){m=50;type="JACKPOT";cls="historyJackpot";}
  gain=bet*m; medal+=gain;
  flash();shake();
  reels.forEach(r=>r.classList.add("rare"));
 }else if([a,b,c].filter(v=>v==="üéûÔ∏è").length>=2){
  gain=bet*3; medal+=gain;
  type="BARÂ∞èÂΩì„Åü„Çä"; flash();
 }else if(a===b||b===c||a===c){
  gain=bet*2; medal+=gain;
  type="Â∞èÂΩì„Åü„Çä"; flash();
 }

 addHistory(`${a}${b}${c}`,type,gain,cls);
 msg(type+(gain?` +${gain}`:""));
 update();
}

/* ÊäΩÈÅ∏ */
function lot(){
 let r=Math.random()*100,sum=0;
 for(const t of table){sum+=t.w;if(r<sum)return t.s;}
}

/* ÊºîÂá∫ */
function flash(){
 game.classList.add("flash");
 setTimeout(()=>game.classList.remove("flash"),400);
}
function shake(){
 game.classList.add("shake");
 setTimeout(()=>game.classList.remove("shake"),250);
}

/* Â±•Ê≠¥ */
function addHistory(result,type,gain,cls){
 history.unshift({result,type,gain,cls});
 history=history.slice(0,30);
 save();renderHistory();
}
function renderHistory(){
 historyBox.innerHTML=history.map(h=>
  `<div class="historyItem ${h.cls}">
   ${h.result}ÔΩú${h.type}${h.gain?` +${h.gain}`:""}
  </div>`
 ).join("");
}
function clearHistory(){history=[];save();renderHistory();msg("Â±•Ê≠¥ÂâäÈô§");}

/* UI */
function update(){medalEl.textContent=medal;}
function msg(t){msgEl.textContent=t;}
function toggleSound(){sound=!sound;msg(sound?"üîäON":"üîáOFF");}

/* ‰øùÂ≠ò */
function save(){
 localStorage.setItem("slot",JSON.stringify({medal,history}));
}
function load(){
 const d=localStorage.getItem("slot");
 if(d){
  const o=JSON.parse(d);
  medal=o.medal??100;
  history=o.history??[];
 }
}

/* „Ç≠„Éº„Éú„Éº„Éâ */
document.addEventListener("keydown",e=>{
 if(e.code==="Space"||e.code==="Enter"){e.preventDefault();start();}
 if(e.key==="1")stopReel(0);
 if(e.key==="2")stopReel(1);
 if(e.key==="3")stopReel(2);
 if(e.key==="r"||e.key==="R"){stopReel(0);stopReel(1);stopReel(2);}
 if(e.key==="b"||e.key==="B"){
  betEl.selectedIndex=(betEl.selectedIndex+1)%betEl.length;
 }
 if(e.key==="s"||e.key==="S")toggleSound();
 if(e.key==="Delete")clearHistory();
});
</script>
</body>
</html>
